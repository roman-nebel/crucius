<div id="canvas"></div>
<button id="catch">Catch element</button>
<form id="config" oninput="updatePreview(event)">
  <label for="translateX">TranslateX</label>
  <input id="translateX" type="range" min="-100" max="100" value="0" />
  <label for="translateY">TranslateY</label>
  <input id="translateY" type="range" min="-100" max="100" value="0" />
  <label for="perspective">Perspective</label>
  <input id="perspective" type="range" min="-1" max="100" value="-1" />
  <label for="rotateX">RotateX</label>
  <input id="rotateX" type="range" min="-89" max="89" value="0" />
  <label for="rotateY">RotateY</label>
  <input id="rotateY" type="range" min="-89" max="89" value="0" />
  <label for="rotateZ">RotateZ</label>
  <input id="rotateZ" type="range" min="-180" max="180" value="0" />
  <label for="scaleX">ScaleX</label>
  <input id="scaleX" type="range" min="0.1" max="10" step="0.1" value="1" />
  <label for="scaleY">ScaleY</label>
  <input id="scaleY" type="range" min="0.1" max="10" step="0.1" value="1" />
  <label for="skewX">SkewX</label>
  <input id="skewX" type="range" min="-89" max="89" value="0" />
  <label for="skewY">SkewY</label>
  <input id="skewY" type="range" min="-89" max="89" value="0" />
</form>
<form id="origin" oninput="updateOrigin(event)">
  <label for="originX">OriginX</label>
  <input id="originX" type="range" min="0" max="100" value="50" />
  <label for="originY">OriginY</label>
  <input id="originX" type="range" min="0" max="100" value="50" />
</form>
<style>
  #canvas {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 80%;
    overflow: hidden;
  }

  #canvas svg {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
  }
</style>

<script>
  document.getElementById("catch").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "catch" } }, "*");
  };

  function updatePreview(e) {
    const inputs = Array.from(
      document.getElementById("config").querySelectorAll("input")
    );
    const params = inputs.map((input) => {
      const { id, value } = input;

      if (id === "perspective" && value === "-1") {
        console.log("here");
        return "perspective(none)";
      }

      let unit = "px";
      if (id && id.includes("scale")) {
        unit = "";
      } else if (id && (id.includes("rotate") || id.includes("skew"))) {
        unit = "deg";
      }
      return `${id}(${value}${unit})`;
    });

    params.push("scale3d(1, 1, 1)");

    const svg = document.getElementById("canvas").children[0];
    svg.style.transform = params.join(" ");
    svg.style.vectorEffect = "non-scaling-stroke";
    svg.style.shapeRendering = "geometricPrecision";
    svg.style.willChange = "transform";
  }

  function updateOrigin(e) {
    const inputs = Array.from(
      document.getElementById("origin").querySelectorAll("input")
    );
    const [originX, originY] = inputs.map((input) => input.value);

    const svg = document.getElementById("canvas").children[0];
    svg.style.transformOrigin = `${originX}% ${originY}%`;
  }

  onmessage = (event) => {
    const svg = event.data.pluginMessage;
    const canvas = document.getElementById("canvas");
    const canvesHeight = canvas.offsetHeight;
    document.getElementById("perspective").max = 10 * canvesHeight;
    document.getElementById("canvas").innerHTML = svg;
  };
</script>
